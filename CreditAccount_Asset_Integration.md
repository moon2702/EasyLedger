# 信贷账户与资产计算集成

## 功能概述
信贷账户的已用额度现在会自动汇总到资产页面的"应付"金额中，并影响净资产计算。

## 实现逻辑

### 1. 资产计算更新
在`AssetsFragment.updateAssetValues()`方法中：

```java
// 处理信贷账户
if (account.isCreditAccount()) {
    // 信贷账户的已用额度计入应付和总负债
    double usedCredit = account.getUsedCredit();
    creditUsedTotal += usedCredit;
    payableTotal += usedCredit;
    totalLiability += usedCredit;
    continue; // 信贷账户不参与其他类型计算
}
```

### 2. 应付金额显示
应付金额现在会显示信贷账户的已用额度：

- **只有信贷负债**：`应付: 3000.00 (信贷)`
- **混合负债**：`应付: 5000.00 (信贷: 3000.00)`
- **无信贷负债**：`应付: 2000.00`

### 3. 净资产计算
净资产 = 总资产 - 总负债

其中总负债包括：
- 正常账户中的负债类型账户余额
- 信贷账户的已用额度

## 使用场景示例

### 场景1：用户有信用卡欠款
- 信用卡额度：10000元
- 已使用：3000元
- 储蓄卡余额：5000元

**显示结果**：
- 总资产：5000.00
- 总负债：3000.00
- 净资产：2000.00
- 应付：3000.00 (信贷)

### 场景2：用户有混合负债
- 信用卡已用：2000元
- 其他应付：1000元
- 储蓄卡余额：8000元

**显示结果**：
- 总资产：8000.00
- 总负债：3000.00
- 净资产：5000.00
- 应付：3000.00 (信贷: 2000.00)

### 场景3：用户还清信用卡
- 信用卡已用：0元
- 储蓄卡余额：5000元

**显示结果**：
- 总资产：5000.00
- 总负债：0.00
- 净资产：5000.00
- 应付：0.00

## 实时更新
当用户进行以下操作时，资产页面会自动更新：

1. **使用信贷账户支出**：
   - 信贷账户已用额度增加
   - 应付金额增加
   - 净资产减少

2. **向信贷账户还款**：
   - 信贷账户已用额度减少
   - 应付金额减少
   - 净资产增加

3. **添加/删除信贷账户**：
   - 自动重新计算所有相关数值

## 技术实现细节

### 数据流
1. 用户操作 → AccountBalanceManager更新账户
2. 账户更新 → 数据库更新
3. 数据库更新 → LiveData通知
4. LiveData通知 → AssetsFragment.updateAssetValues()
5. 重新计算 → UI更新

### 关键方法
- `Account.isCreditAccount()`: 判断是否为信贷账户
- `Account.getUsedCredit()`: 获取已用额度
- `AssetsFragment.updateAssetValues()`: 重新计算资产

## 测试建议

1. **创建测试数据**：
   - 创建储蓄账户（余额5000元）
   - 创建信贷账户（额度10000元）

2. **测试支出**：
   - 使用信贷账户支出1000元
   - 检查应付金额是否显示1000.00 (信贷)
   - 检查净资产是否减少1000元

3. **测试还款**：
   - 向信贷账户还款500元
   - 检查应付金额是否显示500.00 (信贷)
   - 检查净资产是否增加500元

4. **测试多账户**：
   - 创建多个信贷账户
   - 验证已用额度是否正确汇总

## 注意事项

1. **信贷账户不参与其他类型计算**：信贷账户只影响应付和总负债，不参与现金、理财等其他类型计算

2. **实时同步**：所有计算都基于LiveData，确保数据实时同步

3. **显示格式**：应付金额会根据是否有信贷负债显示不同的格式，提供更清晰的信息
